
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Matrix Utilities &#8212; wsp-balsa 1.3.0 documentation</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plotting Utilities" href="plotting.html" />
    <link rel="prev" title="Modelling Utilities" href="modelling.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    
      
      <link rel="icon" sizes="16x16" href="../_static/favicon-16x16.png">
      
    
      
      <link rel="icon" sizes="32x32" href="../_static/favicon-32x32.png">
      
    
      
      <link rel="apple-touch-icon" sizes="180x180" href="../_static/apple-touch-icon.png">
      
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/logo.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Routines
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../logging/index.html">
  Logging
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/wsp-sag/balsa" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="general.html">
   General Utilities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="io.html">
   IO Utilities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="modelling.html">
   Modelling Utilities
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Matrix Utilities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="plotting.html">
   Plotting Utilities
  </a>
 </li>
</ul>

  </div>
</nav>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="module-balsa.routines.matrices">
<span id="matrix-utilities"></span><h1>Matrix Utilities<a class="headerlink" href="#module-balsa.routines.matrices" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="balsa.routines.matrices.aggregate_matrix">
<span class="sig-prename descclassname"><span class="pre">balsa.routines.matrices.</span></span><span class="sig-name descname"><span class="pre">aggregate_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">matrix:</span> <span class="pre">typing.Union[pandas.core.frame.DataFrame,</span> <span class="pre">pandas.core.series.Series],</span> <span class="pre">groups:</span> <span class="pre">typing.Optional[typing.Union[pandas.core.series.Series,</span> <span class="pre">numpy.ndarray]]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">row_groups:</span> <span class="pre">typing.Optional[typing.Union[pandas.core.series.Series,</span> <span class="pre">numpy.ndarray]]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">col_groups:</span> <span class="pre">typing.Optional[typing.Union[pandas.core.series.Series,</span> <span class="pre">numpy.ndarray]]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">aggfunc:</span> <span class="pre">typing.Callable[[typing.Iterable[typing.Union[int,</span> <span class="pre">float]]],</span> <span class="pre">typing.Union[int,</span> <span class="pre">float]]</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">sum&gt;</span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">pandas.core.frame.DataFrame</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">pandas.core.series.Series</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#balsa.routines.matrices.aggregate_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregates a matrix based on mappings provided for each axis, using a specified aggregation function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>matrix</strong> (<em>Union</em><em>[</em><em>pandas.DataFrame</em><em>, </em><em>pandas.Series</em><em>]</em>) – Matrix data to aggregate. DataFrames and Series with 2-level
indices are supported</p></li>
<li><p><strong>groups</strong> (<em>Union</em><em>[</em><em>pandas.Series</em><em>, </em><em>numpy.ndarray</em><em>]</em><em>, </em><em>optional</em>) – Syntactic sugar to specify both row_groups and
col_groups to use the same grouping series.</p></li>
<li><p><strong>row_groups</strong> (<em>Union</em><em>[</em><em>pandas.Series</em><em>, </em><em>numpy.ndarray</em><em>]</em><em>, </em><em>optional</em>) – Groups for the rows. If aggregating a DataFrame,
this must match the index of the matrix. For a “tall” matrix, this series can match either the “full” index
of the series, or it can match the first level of the matrix (it would be the same as if aggregating a
DataFrame). Alternatively, an array can be provided, but it must be the same length as the DataFrame’s
index, or the full length of the Series.</p></li>
<li><p><strong>col_groups</strong> (<em>Union</em><em>[</em><em>pandas.Series</em><em>, </em><em>numpy.ndarray</em><em>]</em><em>, </em><em>optional</em>) – Groups for the columns. If aggregating a DataFrame,
this must match the columns of the matrix. For a “tall” matrix, this series can match either the “full”
index of the series, or it can match the second level of the matrix (it would be the same as if aggregating
a DataFrame). Alternatively, an array can be provided, but it must be the same length as the DataFrame’s
columns, or the full length of the Series.</p></li>
<li><p><strong>aggfunc</strong> – The aggregation function to use. Default is np.sum.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The aggregated matrix, in the same type as was provided, e.g. Series -&gt; Series, DataFrame -&gt; DataFrame.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas.Series or pandas.DataFrame</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p>matrix:</p>
<table class="table">
<colgroup>
<col style="width: 25%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>1</p></th>
<th class="head"><p>2</p></th>
<th class="head"><p>3</p></th>
<th class="head"><p>4</p></th>
<th class="head"><p>5</p></th>
<th class="head"><p>6</p></th>
<th class="head"><p>7</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>1</strong></p></td>
<td><p>2</p></td>
<td><p>1</p></td>
<td><p>9</p></td>
<td><p>6</p></td>
<td><p>7</p></td>
<td><p>8</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p><strong>2</strong></p></td>
<td><p>4</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>4</p></td>
<td><p>8</p></td>
<td><p>7</p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p><strong>3</strong></p></td>
<td><p>5</p></td>
<td><p>8</p></td>
<td><p>5</p></td>
<td><p>3</p></td>
<td><p>5</p></td>
<td><p>9</p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p><strong>4</strong></p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>9</p></td>
<td><p>4</p></td>
<td><p>9</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p><strong>5</strong></p></td>
<td><p>6</p></td>
<td><p>3</p></td>
<td><p>4</p></td>
<td><p>6</p></td>
<td><p>9</p></td>
<td><p>9</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p><strong>6</strong></p></td>
<td><p>7</p></td>
<td><p>2</p></td>
<td><p>5</p></td>
<td><p>8</p></td>
<td><p>2</p></td>
<td><p>5</p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p><strong>7</strong></p></td>
<td><p>3</p></td>
<td><p>1</p></td>
<td><p>8</p></td>
<td><p>6</p></td>
<td><p>3</p></td>
<td><p>5</p></td>
<td><p>6</p></td>
</tr>
</tbody>
</table>
<p>groups:</p>
<table class="table">
<colgroup>
<col style="width: 70%" />
<col style="width: 30%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>1</strong></p></td>
<td><p>A</p></td>
</tr>
<tr class="row-even"><td><p><strong>2</strong></p></td>
<td><p>B</p></td>
</tr>
<tr class="row-odd"><td><p><strong>3</strong></p></td>
<td><p>A</p></td>
</tr>
<tr class="row-even"><td><p><strong>4</strong></p></td>
<td><p>A</p></td>
</tr>
<tr class="row-odd"><td><p><strong>5</strong></p></td>
<td><p>C</p></td>
</tr>
<tr class="row-even"><td><p><strong>6</strong></p></td>
<td><p>C</p></td>
</tr>
<tr class="row-odd"><td><p><strong>7</strong></p></td>
<td><p>B</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">new_matrix</span> <span class="pre">=</span> <span class="pre">aggregate_matrix(matrix,</span> <span class="pre">groups=groups)</span></code></p>
<p>new_matrix:</p>
<table class="table">
<colgroup>
<col style="width: 37%" />
<col style="width: 21%" />
<col style="width: 21%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>A</p></th>
<th class="head"><p>B</p></th>
<th class="head"><p>C</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>A</strong></p></td>
<td><p>42</p></td>
<td><p>28</p></td>
<td><p>42</p></td>
</tr>
<tr class="row-odd"><td><p><strong>B</strong></p></td>
<td><p>26</p></td>
<td><p>14</p></td>
<td><p>23</p></td>
</tr>
<tr class="row-even"><td><p><strong>C</strong></p></td>
<td><p>36</p></td>
<td><p>17</p></td>
<td><p>25</p></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balsa.routines.matrices.disaggregate_matrix">
<span class="sig-prename descclassname"><span class="pre">balsa.routines.matrices.</span></span><span class="sig-name descname"><span class="pre">disaggregate_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">matrix</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.core.frame.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapping</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">pandas.core.series.Series</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proportions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">pandas.core.series.Series</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row_mapping</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">pandas.core.series.Series</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">row_proportions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">pandas.core.series.Series</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_mapping</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">pandas.core.series.Series</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">col_proportions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">pandas.core.series.Series</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pandas.core.frame.DataFrame</span></span></span><a class="headerlink" href="#balsa.routines.matrices.disaggregate_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Split multiple rows and columns in a matrix all at once. The cells in the matrix MUST be numeric, but the row
and column labels do not.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>matrix</strong> (<em>pandas.DataFrame</em>) – The input matrix to disaggregate</p></li>
<li><p><strong>mapping</strong> (<em>pandas.Series</em><em>, </em><em>optional</em>) – Dict-like Series of “New label” : “Old label”. Sets both the row_mapping and
col_mapping variables if provided (resulting in a square matrix).</p></li>
<li><p><strong>proportions</strong> (<em>pandas.Series</em><em>, </em><em>optional</em>) – Dict-like Series of “New label”: “Proportion of old label”. Its index
must match the index of the mapping argument. Sets both the row_proportions and col_proportions arguments
if provided.</p></li>
<li><p><strong>row_mapping</strong> (<em>pandas.Series</em><em>, </em><em>optional</em>) – Same as mapping, except applied only to the rows.</p></li>
<li><p><strong>row_proportions</strong> (<em>pandas.Series</em><em>, </em><em>optional</em>) – Same as proportions, except applied only to the rows</p></li>
<li><p><strong>col_mapping</strong> (<em>pandas.Series</em><em>, </em><em>optional</em>) – Same as mapping, except applied only to the columns.</p></li>
<li><p><strong>col_proportions</strong> (<em>pandas.Series</em><em>, </em><em>optional</em>) – Same as proportions, except applied only to the columns</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An expanded DataFrame with the new indices. The new matrix will sum to the same total as the original.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>df:</p>
<table class="table">
<colgroup>
<col style="width: 20%" />
<col style="width: 27%" />
<col style="width: 27%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>A</p></th>
<th class="head"><p>B</p></th>
<th class="head"><p>C</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A</p></td>
<td><p>10</p></td>
<td><p>30</p></td>
<td><p>20</p></td>
</tr>
<tr class="row-odd"><td><p>B</p></td>
<td><p>20</p></td>
<td><p>10</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p>C</p></td>
<td><p>30</p></td>
<td><p>20</p></td>
<td><p>20</p></td>
</tr>
</tbody>
</table>
<p>correspondence:</p>
<table class="table">
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 38%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>new</p></th>
<th class="head"><p>old</p></th>
<th class="head"><p>prop</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A1</p></td>
<td><p>A</p></td>
<td><p>0.25</p></td>
</tr>
<tr class="row-odd"><td><p>A2</p></td>
<td><p>A</p></td>
<td><p>0.75</p></td>
</tr>
<tr class="row-even"><td><p>B1</p></td>
<td><p>B</p></td>
<td><p>0.55</p></td>
</tr>
<tr class="row-odd"><td><p>B2</p></td>
<td><p>B</p></td>
<td><p>0.45</p></td>
</tr>
<tr class="row-even"><td><p>C1</p></td>
<td><p>C</p></td>
<td><p>0.62</p></td>
</tr>
<tr class="row-odd"><td><p>C2</p></td>
<td><p>C</p></td>
<td><p>0.38</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">new_matrix</span> <span class="pre">=</span> <span class="pre">disaggregate_matrix(df,</span> <span class="pre">mapping=correspondence['old'],</span> <span class="pre">proportions=correspondence['prop'])</span></code></p>
<p>new_matrix:</p>
<table class="table">
<colgroup>
<col style="width: 10%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 16%" />
<col style="width: 16%" />
<col style="width: 14%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>new</p></th>
<th class="head"><p>A1</p></th>
<th class="head"><p>A2</p></th>
<th class="head"><p>B1</p></th>
<th class="head"><p>B2</p></th>
<th class="head"><p>C1</p></th>
<th class="head"><p>C2</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>A1</p></td>
<td><p>0.625</p></td>
<td><p>1.875</p></td>
<td><p>4.125</p></td>
<td><p>3.375</p></td>
<td><p>3.100</p></td>
<td><p>1.900</p></td>
</tr>
<tr class="row-odd"><td><p>A2</p></td>
<td><p>1.875</p></td>
<td><p>5.625</p></td>
<td><p>12.375</p></td>
<td><p>10.125</p></td>
<td><p>9.300</p></td>
<td><p>5.700</p></td>
</tr>
<tr class="row-even"><td><p>B1</p></td>
<td><p>2.750</p></td>
<td><p>8.250</p></td>
<td><p>3.025</p></td>
<td><p>2.475</p></td>
<td><p>3.410</p></td>
<td><p>2.090</p></td>
</tr>
<tr class="row-odd"><td><p>B2</p></td>
<td><p>2.250</p></td>
<td><p>6.750</p></td>
<td><p>2.475</p></td>
<td><p>2.025</p></td>
<td><p>2.790</p></td>
<td><p>1.710</p></td>
</tr>
<tr class="row-even"><td><p>C1</p></td>
<td><p>4.650</p></td>
<td><p>13.95</p></td>
<td><p>6.820</p></td>
<td><p>5.580</p></td>
<td><p>7.688</p></td>
<td><p>4.712</p></td>
</tr>
<tr class="row-odd"><td><p>C2</p></td>
<td><p>2.850</p></td>
<td><p>8.55</p></td>
<td><p>4.180</p></td>
<td><p>3.420</p></td>
<td><p>4.712</p></td>
<td><p>2.888</p></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balsa.routines.matrices.fast_stack">
<span class="sig-prename descclassname"><span class="pre">balsa.routines.matrices.</span></span><span class="sig-name descname"><span class="pre">fast_stack</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">frame</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.core.frame.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">multi_index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.core.indexes.multi.MultiIndex</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deep_copy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pandas.core.series.Series</span></span></span><a class="headerlink" href="#balsa.routines.matrices.fast_stack" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs the same action as <code class="docutils literal notranslate"><span class="pre">DataFrame.stack()</span></code>, but provides better performance when the target stacked index
is known before hand. Useful in converting a lot of matrices from “wide” to “tall” format. The inverse of
<code class="docutils literal notranslate"><span class="pre">fast_unstack()</span></code>.</p>
<p class="rubric">Notes</p>
<p>This function does not check that the entries in the multi_index are compatible with the index and columns of
the source DataFrame, only that the lengths are compatible. It can therefore be used to assign a whole new set
of labels to the result.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>frame</strong> (<em>pandas.DataFrame</em>) – The DataFrame to stack.</p></li>
<li><p><strong>multi_index</strong> (<em>pandas.MultiIndex</em>) – The 2-level MultiIndex known ahead-of-time.</p></li>
<li><p><strong>deep_copy</strong> (<em>bool</em><em>, </em><em>optional</em>) – Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>. A flag indicating if the returned Series should be a view of
the underlying data (deep_copy=False) or a copy of it (deep_copy=True). A deep copy takes a little longer to
convert and takes up more memory but preserves the original data of the DataFrame. The default value of True
is recommended for most uses.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The stacked data.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas.Series</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balsa.routines.matrices.fast_unstack">
<span class="sig-prename descclassname"><span class="pre">balsa.routines.matrices.</span></span><span class="sig-name descname"><span class="pre">fast_unstack</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">series</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.core.series.Series</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">index</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.core.indexes.base.Index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">columns</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.core.indexes.base.Index</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deep_copy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pandas.core.frame.DataFrame</span></span></span><a class="headerlink" href="#balsa.routines.matrices.fast_unstack" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs the same action as <code class="docutils literal notranslate"><span class="pre">DataFrame.unstack()</span></code>, but provides better performance when the target unstacked
index and columns are known before hand. Useful in converting a lot of matrices from “tall” to “wide” format. The
inverse of <code class="docutils literal notranslate"><span class="pre">fast_stack()</span></code>.</p>
<p class="rubric">Notes</p>
<p>This function does not check that the entries in index and columns are compatible with the MultiIndex of the
source Series, only that the lengths are compatible. It can therefore be used to assign a whole new set of
labels to the result.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>series</strong> (<em>pandas.Series</em>) – The Series with 2-level MultiIndex to unstack</p></li>
<li><p><strong>index</strong> (<em>pandas.Index</em>) – The row index known ahead-of-time</p></li>
<li><p><strong>columns</strong> (<em>pandas.Index</em>) – The columns index known ahead-of-time.</p></li>
<li><p><strong>deep_copy</strong> (<em>bool</em>) – Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>. A flag indicating if the returned DataFrame should be a view of the
underlying data (deep_copy=False) or a copy of it (deep_copy=True). A deep copy takes a little longer to
convert and takes up more memory but preserves the original data of the Series. The default value of True is
recommended for most uses.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The unstacked dat</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balsa.routines.matrices.matrix_balancing_1d">
<span class="sig-prename descclassname"><span class="pre">balsa.routines.matrices.</span></span><span class="sig-name descname"><span class="pre">matrix_balancing_1d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">m</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">numpy.ndarray</span></span></span><a class="headerlink" href="#balsa.routines.matrices.matrix_balancing_1d" title="Permalink to this definition">¶</a></dt>
<dd><p>Balances a matrix using a single constraint.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>m</strong> (<em>numpy.ndarray</em>) – The matrix (a 2-dimensional ndarray) to be balanced</p></li>
<li><p><strong>a</strong> (<em>numpy.ndarray</em>) – The totals vector (a 1-dimensional ndarray) constraint</p></li>
<li><p><strong>axis</strong> (<em>int</em>) – Direction to constrain (0 = along columns, 1 = along rows)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A balanced matrix</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balsa.routines.matrices.matrix_balancing_2d">
<span class="sig-prename descclassname"><span class="pre">balsa.routines.matrices.</span></span><span class="sig-name descname"><span class="pre">matrix_balancing_2d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">m</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">pandas.core.frame.DataFrame</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">b</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">numpy.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">totals_to_use</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'raise'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_iterations</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rel_error</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_procs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">pandas.core.frame.DataFrame</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#balsa.routines.matrices.matrix_balancing_2d" title="Permalink to this definition">¶</a></dt>
<dd><p>Balances a two-dimensional matrix using iterative proportional fitting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>m</strong> (<em>Union</em><em>[</em><em>numpy.ndarray</em><em>, </em><em>pandas.DataFrame</em><em>]</em>) – The matrix (a 2-dimensional ndarray) to be balanced. If a DataFrame
is supplied, the output will be returned as a DataFrame.</p></li>
<li><p><strong>a</strong> (<em>numpy.ndarray</em>) – The row totals (a 1-dimensional ndarray) to use for balancing</p></li>
<li><p><strong>b</strong> (<em>numpy.ndarray</em>) – The column totals (a 1-dimensional ndarray) to use for balancing</p></li>
<li><p><strong>totals_to_use</strong> (<em>str</em><em>, </em><em>optional</em>) – Defaults to <code class="docutils literal notranslate"><span class="pre">'raise'</span></code>. Describes how to scale the row and column totals if
their sums do not match. Must be one of [‘rows’, ‘columns’, ‘average’, ‘raise’].
- rows: scales the columns totals so that their sums matches the row totals
- columns: scales the row totals so that their sums matches the column totals
- average: scales both row and column totals to the average value of their sums
- raise: raises an Exception if the sums of the row and column totals do not match</p></li>
<li><p><strong>max_iterations</strong> (<em>int</em><em>, </em><em>optional</em>) – Defaults to <code class="docutils literal notranslate"><span class="pre">1000</span></code>. Maximum number of iterations</p></li>
<li><p><strong>rel_error</strong> (<em>float</em><em>, </em><em>optional</em>) – Defaults to <code class="docutils literal notranslate"><span class="pre">1.0E-4</span></code>. Relative error stopping criteria</p></li>
<li><p><strong>n_procs</strong> (<em>int</em><em>, </em><em>optional</em>) – Defaults to <code class="docutils literal notranslate"><span class="pre">1</span></code>. Number of processors for parallel computation. (Not used)</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The balanced matrix, residual, and n_iterations</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple[Union[numpy.ndarray, pandas.DataFrame], float, int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balsa.routines.matrices.matrix_bucket_rounding">
<span class="sig-prename descclassname"><span class="pre">balsa.routines.matrices.</span></span><span class="sig-name descname"><span class="pre">matrix_bucket_rounding</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">m</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">pandas.core.frame.DataFrame</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">decimals</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">numpy.ndarray</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">pandas.core.frame.DataFrame</span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#balsa.routines.matrices.matrix_bucket_rounding" title="Permalink to this definition">¶</a></dt>
<dd><p>Bucket rounds to the given number of decimals.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>m</strong> (<em>Union</em><em>[</em><em>numpy.ndarray</em><em>, </em><em>pandas.DataFrame</em><em>]</em>) – The matrix to be rounded</p></li>
<li><p><strong>decimals</strong> (<em>int</em><em>, </em><em>optional</em>) – Defaults to <code class="docutils literal notranslate"><span class="pre">0</span></code>. Number of decimal places to round to. If decimals is negative, it
specifies the number of positions to the left of the decimal point.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The rounded matrix</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Union[numpy.ndarray, pandas.DataFrame]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="balsa.routines.matrices.split_zone_in_matrix">
<span class="sig-prename descclassname"><span class="pre">balsa.routines.matrices.</span></span><span class="sig-name descname"><span class="pre">split_zone_in_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">base_matrix</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">pandas.core.frame.DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">old_zone</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_zones</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proportions</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">pandas.core.frame.DataFrame</span></span></span><a class="headerlink" href="#balsa.routines.matrices.split_zone_in_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Takes a zone in a matrix (as a DataFrame) and splits it into several new zones, prorating affected cells by a
vector of proportions (one value for each new zone). The old zone is removed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>base_matrix</strong> (<em>pandas.DataFrame</em>) – The matrix to re-shape</p></li>
<li><p><strong>old_zone</strong> (<em>int</em>) – The original zone to split</p></li>
<li><p><strong>new_zones</strong> (<em>List</em><em>[</em><em>int</em><em>]</em>) – The list of new zones to add</p></li>
<li><p><strong>proportions</strong> (<em>List</em><em>[</em><em>float</em><em>]</em>) – The proportions to split the original zone to. The list must be the same length as
<code class="docutils literal notranslate"><span class="pre">new_zones</span></code> and sum to 1.0</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The re-shaped matrix</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

</div>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="modelling.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Modelling Utilities</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="plotting.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Plotting Utilities</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, WSP Canada Inc..<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>